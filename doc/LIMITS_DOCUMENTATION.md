# Управление лимитами повербанков

## Организационные единицы

### Поля в базе данных
- `default_powerbank_limit` (int) - Лимит повербанков по умолчанию для пользователей группы
- `reminder_hours` (int) - Через сколько часов отправлять напоминание о возврате повербанка

### Редактирование
**Расположение:** Админ-панель → Управление группами → Редактировать группу

**Доступные действия:**
- Установить лимит повербанков по умолчанию (по умолчанию: 1)
- Установить время до напоминания в часах (по умолчанию: 24)

## Пользователи

### Поле в базе данных
- `powerbank_limit` (int, nullable) - Индивидуальный лимит повербанков пользователя

### Логика работы лимита
1. **Если у пользователя установлен индивидуальный лимит** (`powerbank_limit` не null) → используется индивидуальный лимит
2. **Если индивидуального лимита нет** (`powerbank_limit` = null) → используется лимит организационной единицы (`default_powerbank_limit`)

### Редактирование
**Расположение:** Админ-панель → Пользователи → Детальная информация → Редактировать

**Доступные действия:**
- Установить индивидуальный лимит (ввести число)
- Удалить индивидуальный лимит (кнопка "×" рядом с полем) → будет использоваться лимит группы

### Отображение в таблице
**Колонка "Лимит"** показывает:
- **Синий badge** - индивидуальный лимит пользователя
- **Серый badge** - лимит группы с пометкой "(группа)"

## API

### Обновление организационной единицы
```
PUT /api/org-units/{org_unit_id}
{
  "default_powerbank_limit": 2,
  "reminder_hours": 48
}
```

### Обновление пользователя
```
PUT /api/users/{user_id}
{
  "powerbank_limit": 3  // или null для удаления индивидуального лимита
}
```

## Технические детали

### Frontend
- **Компоненты:** `AddOrgUnitModal.vue`, `OrgUnitCard.vue`, `EditUserModal.vue`, `UsersTable.vue`
- **Store:** `admin.js` → методы `updateOrgUnit()`, `updateUser()`
- **API:** `pythonApi.js` → методы `updateOrgUnit()`, `updateUser()`

### Backend
- **Файлы:** `org_unit_crud.py`, `crud_endpoints.py`
- Поля `default_powerbank_limit` и `reminder_hours` возвращаются в SELECT запросах для организационных единиц
- Поле `powerbank_limit` обрабатывается при обновлении пользователя с валидацией и установкой в БД

### Важно
- Обязательно передавать `powerbank_limit` даже если значение `null` (для возможности сброса индивидуального лимита)
- После всех изменений данных вызывается `commit()` для сохранения в БД

